<head>
  <title>can-i-eat.it</title>
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
	<div id="topDiv">
		<a href="/" class="home">
			<img src="/favicon.ico">
			<span>can-eat.it</span>
		</a> &nbsp;
		{{#constant}}
		{{> browse}} &nbsp;
		{{/constant}}
		{{> search}} &nbsp;

		<span id="rules">
			Rules: &nbsp;
		  <label>
				<input type="checkbox" value="for" checked="checked" disabled>
				<span id="vote_7tvioJpLCDagBJzwG_for">✔</span>Vegan
			</label>
		</span>

		&nbsp; | &nbsp;

		{{> showType}}

  	<div id="topDivRight">
	  	{{loginButtons}}
	  </div>
	</div>

	<div id="mainDiv">
		{{#isolate}}{{renderPage}}{{/isolate}}
	  {{> modalStandard}}
	</div>
</body>

<template name="main">
		{{> heading}}
		{{> products}}
	  <br />
	  {{> actions}}
	  {{> app}}
	  {{> todo}}
	  <!-- bisli bbq 7290000066165 -->
</template>

<template name="heading">
	<h1>
		{{#if $.Session.equals 'QUERY_UPC' ''}}

			{{#if $.Session.equals 'QUERY_SEARCH' ''}}
				Everything
			{{else}}
				'{{$.Session.get 'QUERY_SEARCH'}}'
			{{/if}}

			in

			{{#if $.Session.equals 'QUERY_BROWSE' ''}}
				All Categories
			{{else}}
				'{{browseName}}'
			{{/if}}

		{{else}}

			UPC: {{$.Session.get 'QUERY_UPC'}}

		{{/if}}
	</h1>
</template>

<template name="showType">
	{{#constant}}
	<span id="showType" data-select="{{$.Session.get 'showType'}}">
		<span class="box">
			<span class="all">✱</span>
			<span class="yes">✔</span>
			<span class="no">✗</span>
		</span>
  		<span class="all">Show All</span>
  		<span class="yes">Passes</span>
  		<span class="no">Fails</span>
  	</select>
	</label>
	{{/constant}}
</template>

<template name="actions">
	{{#if currentUser}}
  	<p>
  		<a id="add-product">Add new Product</a> |
  		<a href="/ingredients">Edit Ingredients</a>
  	</p>
  {{else}}
  	<p>Log in to add/edit products</p>
  {{/if}}
</template>

<template name="search">
	<span id="searchWrap">
		<input type="text" id="query" name="search" value="{{search}}" />
		<i class="icon-search"></i><span class="{{#if $.Session.equals 'QUERY_SEARCH' ''}}hidden{{/if}}">✗</span>
	</span>
</template>

<template name="browse">
	{{#constant}}
		<input type='hidden' id="browseSelect" />
	{{/constant}}
</template>

<template name="app">
	<h3>Apps</h3>
	<p>Download the (very simple) <a href="/canieat.apk">can-i-eat Android app</a> to scan
	product barcodes in the shop and see if you can eat it. Demo:</p>
	<iframe width="420" height="315" src="//www.youtube.com/embed/pM_yGG18u6I" frameborder="0" allowfullscreen></iframe>
</template>

<template name="products">
	<div id="productsDiv">
		{{#if ready}}
			{{#if products}}
				{{#each products}}
				<div class="product caneat-{{caneat}} {{show caneat}}">
					<div class="prodImg">
						<div style="background-image: url({{picURL}});"></div>
					</div>
					<div class="status status-{{caneat}}"></div>

					<p><span class="name">{{name}}</span> {{#if currentUser}}<a class="edit">edit</a>{{/if}}</p>
					<ul>
					{{#each caneatMsg}}
						{{#with this}}
						<li>
							{{#if name}}<b>{{name}}</b>{{#if note}}: {{/if}}{{/if}}
							{{note}}
							{{#if source}}<a href="{{source}}" target="_blank">(?)</a>{{/if}}
						</li>
						{{/with}}
					{{/each}}
					</ul>
				</div>
				{{/each}}
			{{else}}
				<p>No results.</p>
			{{/if}}
		{{else}}
				<p>Loading...</p>
		{{/if}}
	</div>
</template>

<template name="todo">
	<h3>Roadmap (if people use this):</h3>
	<ol>
		<li>Multi language support, starting with עברית :)  PLEASE ONLY ADD CONTENT IN ENGLISH (for now).</li>
		<li style="text-decoration: line-through">Mobile app that can scan product barcodes and tell you instantly if you can eat it.</li>
		<li>Currently products are VEGAN or NON-VEGAN.  Add support for gluten, low-carb, diabetics, etc, including
			combinations (e.g. gluten-free vegan food without soya)</li>
		<li>Subsets, e.g. VEGAN must be MILK-FREE, etc.  Cream can be marked as MILK, not vegan.</li>
		<li>Allow upload of pictures instead of just using existing URLs</li>
		<li>Crawling and Open Graph (Facebook preview) support
		<li>Offline support (will make app much faster too)</li>
		<li>REST endpoints for other apps to use the data.  Open source the website.</li>
		<li>Ads, with 50% of proceeds going to animal charities</li>
	</ol>
</template>

<template name="add-product">
	<p>Try searching on <a href="http://foodmarket.co.il/" target="_blank">foodmarket</a> and 
		<a href="http://www.foodsdictionary.co.il/" target="_blank">foodsdictionary</a> for picture, barcode,
		and nutrional information.</p>
	<form id="add-product">
		<table class="editProduct" data-product-id="{{_id}}">
		<tr><td>Name:</td><td><input type="text" id="add-product-name" value="{{name}}" /></td></tr>
		<tr><td>Company:</td><td><input type="hidden" id="add-product-company" value="{{company}}" /><td></tr>
		<tr><td>Categories:</td><td><input type="hidden" id="add-product-categories" value="{{categories}}" /><td></tr>
		<tr><td>Barcode</td><td><input type="text" id="add-product-barcode" value="{{barcode}}" /><td></tr>
		<tr><td>PicURL:</td><td><input type="text" id="add-product-picURL" value="{{picURL}}" <td></tr>
		<tr><td>Ingredients:</td><td><input type="hidden" id="add-product-ingredients" value="{{ingredients}}"/><td></tr>
		{{props}}
		</table>
	</form>
</template>

<template name="edit-product">
	<p>Try searching on <a href="http://foodmarket.co.il/" target="_blank">foodmarket</a> and 
		<a href="http://www.foodsdictionary.co.il/" target="_blank">foodsdictionary</a> for picture, barcode,
		and nutrional information.</p>
	<form id="edit-product">
		{{#with product}}
		<table class="editProduct" data-product-id="{{_id}}">
		<tr><td>Name:</td><td><span data-id="name">{{name}}</span></td></tr>
		<tr><td>Company:</td><td><span data-type="select2" data-value="{{company}}" data-id="company"></span><td></tr>
		<tr><td>Categories:</td><td><span data-type="select2" data-value="{{categories}}" data-id="categories"></span><td></tr>
		<tr><td>Barcode</td><td><span data-id="barcode">{{barcode}}</span><td></tr>
		<tr><td>PicURL:</td><td><span data-id="picURL">{{picURL}}</span><td></tr>
		<tr><td>Ingredients:</td><td><span data-type="select2" data-value="{{ingredients}}" data-id="ingredients"></span><td></tr>
		<tr><td><br /><b><u>Overrides:</u></b></td>
			<td><br />Only use the below to override the ingredients (e.g. E631 definitely vegan).</td></tr>
		{{props}}
		</table>
		{{/with}}
	</form>
</template>

<template name="modalStandard">
    <div class="modal hide fade" id="modalStandard">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>{{title}}</h3>
        </div>
        <div class="modal-body">
            {{body}}
        </div>
        {{#constant}}
        <div class="modal-footer">
            <a href="#" class="btn" data-dismiss="modal">Cancel</a>
            <a href="#" class="btn btn-primary" data-dismiss="modal">Save changes</a>
        </div>
        {{/constant}}
    </div>
</template>
